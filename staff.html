<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù | Ø¬Ù…Ø¹ÙŠØ© Ø±ÙØ§Ù‡</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0e0b14;
  --bg2:#1a1326;
  --p:#7a5ea8;
  --s:#b88fcf;
  --txt:#f3f4f6;
  --muted:#b6b1c6;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Tajawal",sans-serif;
  color:var(--txt);
  background:
    radial-gradient(700px 400px at 80% 20%, rgba(184,143,207,.15), transparent 60%),
    linear-gradient(180deg,var(--bg),var(--bg2));
  padding:30px;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
}
.header h2{
  font-size:26px;
  font-weight:800;
}
.badge{
  background:rgba(184,143,207,.2);
  border:1px solid rgba(184,143,207,.4);
  padding:8px 14px;
  border-radius:999px;
  font-size:14px;
}

/* ÙƒØ±Øª */
.card{
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.15);
  backdrop-filter:blur(14px);
  border-radius:22px;
  padding:20px;
}

/* Ø¬Ø¯ÙˆÙ„ */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:14px;
  text-align:center;
  border-bottom:1px solid rgba(255,255,255,.15);
}
th{
  color:var(--s);
  font-weight:800;
  font-size:14px;
}
td{
  font-size:14px;
}

/* Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø¯ÙˆØ¨ */
select{
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.2);
  color:#fff;
  padding:8px;
  border-radius:12px;
  margin-bottom:6px;
}

/* Ø²Ø± */
button{
  background:linear-gradient(135deg,var(--p),var(--s));
  border:none;
  border-radius:999px;
  padding:8px 16px;
  font-weight:800;
  cursor:pointer;
  color:#fff;
  transition:.25s;
}
button:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px rgba(184,143,207,.4);
}

/* Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© */
.empty{
  text-align:center;
  padding:40px;
  color:var(--muted);
  font-size:15px;
}
</style>
</head>

<body>

<div class="header">
  <h2>ğŸ§‘â€ğŸ’¼ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù</h2>
  <div class="badge">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
</div>

<div class="card">
  <table id="reqTable">
    <thead>
      <tr>
        <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
        <th>Ø§Ù„Ø­ÙŠ</th>
        <th>Ø¥Ø³Ù†Ø§Ø¯</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="emptyState" class="empty" style="display:none">
    âœ¨ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§
  </div>
</div>

<script>
function loadRequests(){
  google.script.run.withSuccessHandler(render).getNewRequests();
}

function render(data){
  const tbody = document.querySelector("#reqTable tbody");
  const empty = document.getElementById("emptyState");
  tbody.innerHTML = "";

  if(!data.length){
    empty.style.display="block";
    return;
  }
  empty.style.display="none";

  data.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.id}</td>
      <td>${r.name}</td>
      <td>${r.phone}</td>
      <td>${r.area}</td>
      <td>
        <select id="agent-${r.id}">
          <option value="">ğŸ‘¤ Ø§Ø®ØªØ± Ù…Ù†Ø¯ÙˆØ¨</option>
          <option value="Ù…Ù†Ø¯ÙˆØ¨ 1">Ù…Ù†Ø¯ÙˆØ¨ 1</option>
          <option value="Ù…Ù†Ø¯ÙˆØ¨ 2">Ù…Ù†Ø¯ÙˆØ¨ 2</option>
        </select>
        <br>
        <button onclick="assign('${r.id}')">âœ”ï¸ Ø¥Ø³Ù†Ø§Ø¯</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function assign(id){
  const agent = document.getElementById("agent-"+id).value;
  if(!agent){
    alert("Ø§Ø®ØªØ± Ù…Ù†Ø¯ÙˆØ¨ Ø£ÙˆÙ„Ù‹Ø§");
    return;
  }

  google.script.run.withSuccessHandler(()=>{
    loadRequests();
  }).assignRequest(id, agent);
}

loadRequests();
</script>

</body>
</html>
