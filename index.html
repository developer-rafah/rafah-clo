<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ØªØ¨Ø±Ø¹ ÙØ§Ø¦Ø¶ Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ | Ø¬Ù…Ø¹ÙŠØ© Ø±ÙØ§Ù‡</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
:root{
  --bg:#0e0b14;
  --bg2:#1a1326;
  --p:#7a5ea8;
  --s:#b88fcf;
  --txt:#f3f4f6;
  --muted:#b6b1c6;
  --wa:#25D366;

  /* Ø¥Ø¶Ø§ÙØ§Øª */
  --ok:#34d399;
  --err:#fb7185;

  /* Ø¥Ø¶Ø§ÙØ§Øª Ù„Ù„Ù†Ø¬Ø§Ø­ */
  --card: rgba(255,255,255,.10);
  --cardBorder: rgba(255,255,255,.22);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Tajawal",sans-serif;
  color:var(--txt);
  background:
    radial-gradient(700px 400px at 80% 20%, rgba(184,143,207,.16), transparent 60%),
    linear-gradient(180deg,var(--bg),var(--bg2));
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.entry-popup{
  position:fixed; inset:0;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(8px);
  z-index:9999;
}
.entry-box{
  max-width:320px;
  padding:18px 22px;
  border-radius:18px;
  background:linear-gradient(135deg,var(--p),var(--s));
  font-size:16px;
  font-weight:800;
  text-align:center;
  animation:scaleUp .4s ease;
}
@keyframes scaleUp{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* Scroll Reveal */
.reveal{opacity:0;transform:translateY(22px);transition:.8s}
.reveal.show{opacity:1;transform:none}

/* Ø§Ù„ØªØ®Ø·ÙŠØ· */
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.card{
  width:min(1050px,100%);
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.15);
  backdrop-filter:blur(14px);
  border-radius:30px;
  display:grid;
  grid-template-columns:1fr 1fr;
}
@media(max-width:900px){.card{grid-template-columns:1fr}}

.content{padding:40px;text-align:center}
.logo{
  max-width:170px;
  margin:0 auto 26px;
  display:block;
  animation:breath 4s ease-in-out infinite;
}
@keyframes breath{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.04)}
}

h1{
  font-size:clamp(26px,4vw,40px);
  font-weight:900;
  background:linear-gradient(90deg,#fff,var(--s));
  -webkit-background-clip:text;
  color:transparent;
}
p{line-height:1.9;color:#e5e7eb}

.btn{
  margin-top:28px;
  padding:15px 28px;
  font-size:17px;
  font-weight:900;
  border:none;
  border-radius:999px;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,var(--p),var(--s));
  box-shadow:0 10px 28px rgba(184,143,207,.35);
}

/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ */
.visual{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:32px;
}
.impact{
  width:140px;
  height:140px;
  border-radius:50%;
  border:1.2px dashed rgba(255,255,255,.22);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:hidden;
}
.impact span{
  position:absolute;
  font-weight:900;
  font-size:15px;
  opacity:0;
  transform:scale(.9);
  animation:impactFade 2.6s ease-in-out infinite;
}
@keyframes impactFade{
  0%{opacity:0;transform:scale(.9)}
  20%{opacity:1;transform:scale(1)}
  80%{opacity:1;transform:scale(1)}
  100%{opacity:0;transform:scale(1.05)}
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° */
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(6px);
  display:none;
  align-items:center; justify-content:center;
  z-index:999;
}
.modal-box{
  width:min(420px,92%);
  background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.25);
  border-radius:22px;
  padding:24px;
}
input{
  width:100%;
  margin-top:12px;
  padding:13px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(0,0,0,.35);
  color:#fff;

  /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚Ù„ */
  padding-left:42px;
}

/* ===== Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ù…Ø§Ù„ÙŠØ© + ØªØ­Ù‚Ù‚ ===== */
.error-text{
  font-size:13px;
  color:var(--err);
  margin-top:6px;
  display:none;
  font-weight:700;
}

input.valid{
  border-color: rgba(52,211,153,.9);
  box-shadow: 0 0 0 3px rgba(52,211,153,.18);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2334d399' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 6 9 17l-5-5'/%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position: 12px 50%;
  background-size: 18px 18px;
}

input.invalid{
  border-color: rgba(251,113,133,.95);
  box-shadow: 0 0 0 3px rgba(251,113,133,.16);
}

.shake{
  animation:shake .35s;
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}

/* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
.submit{
  margin-top:14px;
  width:100%;
  padding:14px;
  border-radius:999px;
  border:none;
  font-weight:900;
  background:linear-gradient(135deg,var(--s),var(--p));
  color:#fff;
}
.submit:disabled{
  opacity:.55;
  cursor:not-allowed;
  filter:saturate(.7);
}

/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
#map{
  width:100%;
  height:300px;
  border-radius:16px;
  margin-top:12px;
}
.map-hint{
  font-size:14px;
  font-weight:700;
  color:#fff;
  background:rgba(122,94,168,.9);
  padding:10px 14px;
  border-radius:12px;
  text-align:center;
}

/* ======= Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø© (Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø£ÙŠ Ø´ÙŠØ¡) ======= */
.map-actions{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.map-actions .submit{
  margin-top:0;
  width:auto;
  flex:1;
  padding:12px;
}
#accuracyInfo{
  margin-top:10px;
  font-size:13px;
  font-weight:800;
  text-align:center;
  color:#e5e7eb;
  opacity:.95;
}

/* ÙˆØ§ØªØ³Ø§Ø¨ */
.whatsapp{
  position:fixed;
  bottom:18px;left:18px;
  width:52px;height:52px;
  border-radius:50%;
  background:linear-gradient(135deg,#2eea7b,var(--wa));
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 12px 28px rgba(37,211,102,.45);
}
.whatsapp img{width:26px}

footer{text-align:center;font-size:12px;color:var(--muted);margin:20px}

/* =========================================================
   âœ… ØªØ­Ø³ÙŠÙ† Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (Ø¥Ø¶Ø§ÙØ© Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø£ÙŠ Ø´ÙŠØ¡)
   ========================================================= */
.success-box{
  width:min(520px,94%);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  border:1px solid var(--cardBorder);
  border-radius:24px;
  padding:22px;
  box-shadow: 0 18px 46px rgba(0,0,0,.42);
}
.success-head{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
}
.success-icon{
  width:44px;height:44px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  background: rgba(52,211,153,.16);
  border:1px solid rgba(52,211,153,.35);
  font-size:22px;
}
.success-title{
  margin:0;
  font-size:18px;
  font-weight:900;
}
.success-sub{
  margin:4px 0 0;
  color:#e5e7eb;
  opacity:.92;
  line-height:1.8;
  font-size:14px;
}
.req-card{
  margin-top:14px;
  padding:14px 14px;
  border-radius:18px;
  background: rgba(0,0,0,.24);
  border: 1px solid rgba(255,255,255,.14);
}
.req-label{
  font-size:12px;
  color:rgba(255,255,255,.72);
  font-weight:800;
  margin-bottom:6px;
}
.req-id{
  font-size:18px;
  font-weight:900;
  letter-spacing:.4px;
  direction:ltr;
  text-align:left;
  padding:10px 12px;
  border-radius:14px;
  background: rgba(255,255,255,.06);
  border:1px dashed rgba(184,143,207,.45);
  overflow-wrap:anywhere;
}
.req-actions{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-top:12px;
}
@media(max-width:420px){ .req-actions{grid-template-columns:1fr} }

.btn-ghost{
  background: rgba(255,255,255,.08);
}
.btn-ok{
  background: linear-gradient(135deg, rgba(52,211,153,1), rgba(16,185,129,1));
}
.btn-site{
  background: linear-gradient(135deg, var(--p), var(--s));
}
.small-note{
  margin-top:10px;
  font-size:12px;
  color:rgba(255,255,255,.72);
  line-height:1.7;
}
.toast{
  position:fixed;
  bottom:18px;
  right:18px;
  z-index:10000;
  background: rgba(0,0,0,.74);
  border:1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(10px);
  color:#fff;
  padding:10px 12px;
  border-radius:14px;
  font-size:13px;
  font-weight:800;
  display:none;
  max-width:min(340px,92vw);
}
.toast.show{display:block; animation: toastIn .18s ease}
@keyframes toastIn{
  from{transform:translateY(8px);opacity:0}
  to{transform:none;opacity:1}
}
</style>
</head>

<body>

<div class="entry-popup" id="entryPopup">
  <div class="entry-box">ÙØ§Ø¦Ø¶ Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„ÙŠÙˆÙ…â€¦ Ø³ØªØ±ÙŒ ÙˆØ¯ÙØ¡ Ù„ØºÙŠØ±Ùƒ ğŸ¤</div>
</div>

<div class="wrap">
  <div class="card reveal">
    <div class="content reveal">
      <img src="https://www.rafah.org.sa/rafed/uploads/website_news/1_6952241baa337.png" class="logo" alt="Ø¬Ù…Ø¹ÙŠØ© Ø±ÙØ§Ù‡">
      <h1>ØªØ¨Ø±Ø¹ ÙØ§Ø¦Ø¶ Ø§Ù„Ù…Ù„Ø§Ø¨Ø³</h1>
      <p>ØªØ¨Ø±Ø¹Ùƒ ÙŠØ³Ù‡Ù… ÙÙŠ Ø³ØªØ± Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ø­ØªØ§Ø¬Ø© ÙˆÙŠØ¹Ø²Ø² Ø§Ù„ØªÙƒØ§ÙÙ„ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠ.</p>
      <button class="btn" onclick="openForm()">ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div class="visual reveal">
      <div class="impact">
        <span id="impactText">Ø£Ø«Ø±Ùƒ Ù…Ø³ØªÙ…Ø±</span>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ù…ÙˆØ°Ø¬ -->
<div class="modal" id="formModal">
  <div class="modal-box">
    <input placeholder="Ø§Ù„Ø§Ø³Ù…">
    <div class="error-text" id="errName"></div>

    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
    <div class="error-text" id="errPhone"></div>

    <input placeholder="Ø§Ù„Ø­ÙŠ">
    <div class="error-text" id="errArea"></div>

    <button class="submit" onclick="openMap()">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
    <div id="locationStatus" style="margin-top:10px;color:#b88fcf"></div>

    <!-- Ù†ÙØ³ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„ÙƒÙ† Ø³ÙŠØªÙ… ØªØ¹Ø·ÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­ØªÙ‰ ØªÙƒØªÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <button class="submit" onclick="openConfirmModal()" id="submitBtn" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
<div class="modal" id="mapModal">
  <div class="modal-box">
    <div class="map-hint">
      Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø¯Ø¨ÙˆØ³ ÙˆØ­Ø¯Ø¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªØ¨Ø±Ø¹
    </div>
    <div id="map"></div>

    <!-- ======= Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© (Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ) ======= -->
    <div class="map-actions">
      <button class="submit" onclick="locateNow()">ğŸ“ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¢Ù†</button>
      <button class="submit" onclick="confirmLocation()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
    </div>
    <div id="accuracyInfo"></div>
    <!-- ======= Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© ======= -->
  </div>
</div>

<a class="whatsapp" href="https://wa.me/966502333499" target="_blank">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg">
</a>

<footer>Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¬Ù…Ø¹ÙŠØ© Ø±ÙØ§Ù‡ Ù„Ù„Ø£Ø±Ø§Ù…Ù„ ÙˆØ§Ù„Ù…Ø·Ù„Ù‚Ø§Øª</footer>

<!-- âœ… Toast Ø¨Ø³ÙŠØ· -->
<div class="toast" id="toast"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
setTimeout(()=>document.getElementById("entryPopup").style.display="none",2600);

/* Scroll Reveal */
const obs=new IntersectionObserver(e=>e.forEach(i=>i.isIntersecting&&i.target.classList.add("show")),{threshold:.15});
document.querySelectorAll(".reveal").forEach(el=>obs.observe(el));

/* Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø«Ø± */
const impactTexts=["Ø£Ø«Ø±Ùƒ Ù…Ø³ØªÙ…Ø±","Ø¯ÙØ¡ ÙŠØµÙ„","Ø³ØªØ±ÙŒ ÙŠØ¯ÙˆÙ…","Ø®ÙŠØ±ÙŒ ÙŠØªØ¶Ø§Ø¹Ù"];
let idx=0;
setInterval(()=>{
  idx=(idx+1)%impactTexts.length;
  document.getElementById("impactText").textContent=impactTexts[idx];
},2600);

/* Ø§Ù„Ù†ÙˆØ§ÙØ° */
function openForm(){
  document.getElementById("formModal").style.display="flex";
  restoreDraft();       // ğŸ”’ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  validateAll();        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª
}

/* ====== Ø¥Ø¶Ø§ÙØ§Øª: Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ + ØªØ­Ù‚Ù‚ + ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ====== */
const STORAGE_KEY = "rafah_donation_draft_v1";

const nameInput  = document.querySelector('#formModal input[placeholder="Ø§Ù„Ø§Ø³Ù…"]');
const phoneInput = document.querySelector('#formModal input[placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„"]');
const areaInput  = document.querySelector('#formModal input[placeholder="Ø§Ù„Ø­ÙŠ"]');

const errName  = document.getElementById("errName");
const errPhone = document.getElementById("errPhone");
const errArea  = document.getElementById("errArea");

const submitBtn = document.getElementById("submitBtn");

function shakeEl(el){
  el.classList.add("shake");
  setTimeout(()=>el.classList.remove("shake"),350);
}
function showErr(inputEl, box, msg){
  box.textContent = msg;
  box.style.display = "block";
  inputEl.classList.add("invalid");
  inputEl.classList.remove("valid");
  shakeEl(inputEl);
}
function clearErr(inputEl, box){
  box.style.display = "none";
  inputEl.classList.remove("invalid");
}

/* âœ… Toast */
function showToast(text){
  const t = document.getElementById("toast");
  if(!t) return;
  t.textContent = text;
  t.classList.add("show");
  clearTimeout(showToast._tmr);
  showToast._tmr = setTimeout(()=>t.classList.remove("show"), 1800);
}

/* Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
function saveDraft(){
  const draft = {
    name: nameInput.value,
    phone: phoneInput.value,
    area: areaInput.value,
    lat: lat,
    lng: lng
  };
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify(draft));
  }catch(e){}
}
function restoreDraft(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const draft = JSON.parse(raw);
    if(draft && typeof draft === "object"){
      if(typeof draft.name === "string") nameInput.value = draft.name;
      if(typeof draft.phone === "string") phoneInput.value = draft.phone;
      if(typeof draft.area === "string") areaInput.value = draft.area;
      if(typeof draft.lat === "number") lat = draft.lat;
      if(typeof draft.lng === "number") lng = draft.lng;

      if(lat && lng){
        document.getElementById("locationStatus").textContent="âœ”ï¸ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø¯Ù‚Ø©";
      }
    }
  }catch(e){}
}

/* Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ */
function isArabicText(s){
  const v = (s || "").trim();
  return v.length > 0 && /^[Ø¡-ÙŠ\s]+$/.test(v);
}
function isSaudiMobile(s){
  const v = (s || "").trim();
  return /^05\d{8}$/.test(v);
}

/* ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ + Ø£ÙŠÙ‚ÙˆÙ†Ø© âœ”ï¸ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… background-image ÙÙŠ CSS) */
function setValid(inputEl, box){
  inputEl.classList.add("valid");
  inputEl.classList.remove("invalid");
  if(box) box.style.display="none";
}
function setInvalid(inputEl){
  inputEl.classList.remove("valid");
}

/* ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
function updateSubmitState(){
  const phoneClean = phoneInput.value.replace(/\D/g,''); // Ù„Ø¶Ù…Ø§Ù† Ù…ØªØµÙ„
  const ok =
    isArabicText(nameInput.value) &&
    isSaudiMobile(phoneClean) &&
    isArabicText(areaInput.value) &&
    !!lat && !!lng;

  submitBtn.disabled = !ok;
}

/* ØªØ­Ù‚Ù‚ Ø´Ø§Ù…Ù„ */
function validateAll(){
  // Ø§Ù„Ø§Ø³Ù…
  if(nameInput.value.trim() === ""){
    clearErr(nameInput, errName);
    setInvalid(nameInput);
  }else if(!isArabicText(nameInput.value)){
    showErr(nameInput, errName, "Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·");
  }else{
    clearErr(nameInput, errName);
    setValid(nameInput, errName);
  }

  // Ø§Ù„Ø¬ÙˆØ§Ù„ (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª - Ù…ØªØµÙ„)
  const cleanedPhone = phoneInput.value.replace(/\D/g,'').slice(0,10);
  phoneInput.value = cleanedPhone; // âœ… Ù…ØªØµÙ„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª
  if(cleanedPhone === ""){
    clearErr(phoneInput, errPhone);
    setInvalid(phoneInput);
  }else if(cleanedPhone.length >= 2 && !cleanedPhone.startsWith("05")){
    showErr(phoneInput, errPhone, "Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05");
  }else if(cleanedPhone.length === 10 && isSaudiMobile(cleanedPhone)){
    clearErr(phoneInput, errPhone);
    setValid(phoneInput, errPhone);
  }else{
    // Ù„Ø§ Ù†Ø¹ØªØ¨Ø±Ù‡ Ø®Ø·Ø£ Ù‚ÙˆÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø§ÙƒØªÙ…Ù„ 10 ÙˆØ®Ø·Ø£
    clearErr(phoneInput, errPhone);
    setInvalid(phoneInput);
  }

  // Ø§Ù„Ø­ÙŠ
  if(areaInput.value.trim() === ""){
    clearErr(areaInput, errArea);
    setInvalid(areaInput);
  }else if(!isArabicText(areaInput.value)){
    showErr(areaInput, errArea, "Ø§Ù„Ø­ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·");
  }else{
    clearErr(areaInput, errArea);
    setValid(areaInput, errArea);
  }

  updateSubmitState();
  saveDraft();
}

/* Ø§Ù„Ø§Ø³Ù…: Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙˆÙ…Ø³Ø§ÙØ§Øª ÙÙ‚Ø· */
nameInput.addEventListener("input", function(){
  const cleaned = this.value.replace(/[^Ø¡-ÙŠ\s]/g,"");
  if(this.value !== cleaned) this.value = cleaned;
  validateAll();
});

/* Ø§Ù„Ø­ÙŠ: Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© ÙˆÙ…Ø³Ø§ÙØ§Øª ÙÙ‚Ø· */
areaInput.addEventListener("input", function(){
  const cleaned = this.value.replace(/[^Ø¡-ÙŠ\s]/g,"");
  if(this.value !== cleaned) this.value = cleaned;
  validateAll();
});

/* Ø§Ù„Ø¬ÙˆØ§Ù„: Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· + 10 + ÙŠØ¨Ø¯Ø£ 05 + Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª */
phoneInput.addEventListener("input", function(){
  let raw = this.value.replace(/\D/g,"");
  if(raw.length > 10) raw = raw.slice(0,10);
  this.value = raw; // âœ… Ù…ØªØµÙ„ Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª
  validateAll();
});

let map,marker,lat,lng;

/* ======= Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¯Ù‚Ø© (Ø¬Ø¯ÙŠØ¯Ø©) ======= */
function getAccuracyLabel(accMeters){
  if(typeof accMeters !== "number") return "â„¹ï¸ Ø§Ù„Ø¯Ù‚Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø©";
  if(accMeters <= 20) return "ğŸ¯ Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©";
  if(accMeters <= 50) return "ğŸ“ Ø¯Ù‚Ø© Ù…ØªÙˆØ³Ø·Ø©";
  return "âš ï¸ Ø¯Ù‚Ø© Ù…Ù†Ø®ÙØ¶Ø©";
}
function setAccuracyUI(accMeters){
  const el = document.getElementById("accuracyInfo");
  if(!el) return;
  if(typeof accMeters === "number"){
    el.textContent = `${getAccuracyLabel(accMeters)} (Â±${Math.round(accMeters)} Ù…ØªØ±)`;
  }else{
    el.textContent = getAccuracyLabel(accMeters);
  }
}
/* ======= Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© ======= */

/* ======= ØªØ·ÙˆÙŠØ± openMap Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ + Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ======= */
function openMap(){
  document.getElementById("mapModal").style.display="flex";

  setTimeout(()=>{
    // Ù„Ùˆ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©: ÙÙ‚Ø· Ø­Ø¯Ù‘Ø« Ø§Ù„Ø­Ø¬Ù… ÙˆØ±ÙƒØ² Ø¹Ù„Ù‰ Ø£Ø­Ø¯Ø« Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
    if(map){
      map.invalidateSize();
      if(lat && lng && marker){
        map.setView([lat,lng],16);
        marker.setLatLng([lat,lng]);
      }
      return;
    }

    // ØªØ­Ø¯ÙŠØ¯ Ù…Ø±ÙƒØ² Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ù„Ùˆ Ù…Ø­ÙÙˆØ¸ lat/lng Ù†Ø¨Ø¯Ø£ Ø¨Ù‡ØŒ ÙˆØ¥Ù„Ø§ Ø§Ù„Ø±ÙŠØ§Ø¶
    const defaultCenter = [24.7136,46.6753];
    const startCenter = (lat && lng) ? [lat,lng] : defaultCenter;
    const startZoom   = (lat && lng) ? 16 : 13;

    map=L.map('map').setView(startCenter,startZoom);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

    marker=L.marker(map.getCenter(),{draggable:true}).addTo(map);

    // âœ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹
    marker.on("dragend", ()=>{
      const p = marker.getLatLng();
      lat = p.lat; lng = p.lng;
      document.getElementById("locationStatus").textContent="ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
      setAccuracyUI(undefined); // Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ø§ ÙŠÙˆØ¬Ø¯ accuracy Ù…Ù† GPS
      saveDraft();
      updateSubmitState();
    });

    // âœ… Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ù…Ø§ Ø¹Ù†Ø¯Ù†Ø§ Ù…ÙˆÙ‚Ø¹ Ù…Ø­ÙÙˆØ¸
    if(!(lat && lng)){
      locateNow();
    }else{
      document.getElementById("locationStatus").textContent="ğŸ“ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸ â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø¥Ø°Ø§ Ù„Ø²Ù…";
      setAccuracyUI(undefined);
    }
  },200);
}

/* ======= Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¢Ù†" ======= */
function locateNow(){
  if(!("geolocation" in navigator)){
    document.getElementById("locationStatus").textContent="âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
    setAccuracyUI(undefined);
    return;
  }

  document.getElementById("locationStatus").textContent="â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§...";
  setAccuracyUI(undefined);

  navigator.geolocation.getCurrentPosition(
    (pos)=>{
      lat = pos.coords.latitude;
      lng = pos.coords.longitude;

      const acc = pos.coords.accuracy;

      // Ù„Ùˆ Ø§Ù„Ø®Ø±ÙŠØ·Ø©/Ø§Ù„Ù…Ø¤Ø´Ø± Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†
      if(map){
        map.setView([lat,lng],16);
      }
      if(marker){
        marker.setLatLng([lat,lng]);
      }

      document.getElementById("locationStatus").textContent="âœ”ï¸ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø¥Ø°Ø§ Ù„Ø²Ù…";
      setAccuracyUI(acc);

      saveDraft();
      updateSubmitState();
    },
    (err)=>{
      console.warn("Geolocation error:", err && err.message ? err.message : err);
      document.getElementById("locationStatus").textContent="âš ï¸ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙƒØŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§";
      setAccuracyUI(undefined);
    },
    {
      enableHighAccuracy:true,
      timeout:10000,
      maximumAge:0
    }
  );
}
/* ======= Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© ======= */

function confirmLocation(){
  const p=marker.getLatLng();
  lat=p.lat; lng=p.lng;
  document.getElementById("locationStatus").textContent="âœ”ï¸ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø¯Ù‚Ø©";
  document.getElementById("mapModal").style.display="none";
  saveDraft();         // ğŸ”’ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹
  updateSubmitState(); // âœ… ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø°Ø§ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
}

/* =========================================================
   âœ… ØªØ­Ø³ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ + Ø£Ø²Ø±Ø§Ø± (Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
   ========================================================= */
const AUTO_REDIRECT_AFTER_SUCCESS = false; // â† Ù„Ùˆ ØªØ¨ØºÙ‰ ØªØ±Ø¬Ø¹Ù‡ "true" ÙŠØ´ØªØºÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
let LAST_REQUEST_ID = "";

function openSuccessModal(requestId){
  LAST_REQUEST_ID = String(requestId || "").trim() || "";
  document.getElementById("sRequestId").textContent = LAST_REQUEST_ID || "ØºÙŠØ± Ù…ØªØ§Ø­";
  document.getElementById("successModal").style.display = "flex";
}
function closeSuccess(){
  document.getElementById("successModal").style.display = "none";
}
async function copyRequestId(){
  if(!LAST_REQUEST_ID){ showToast("Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ØªØ§Ø­"); return; }
  try{
    if(navigator.clipboard && window.isSecureContext){
      await navigator.clipboard.writeText(LAST_REQUEST_ID);
    }else{
      const ta = document.createElement("textarea");
      ta.value = LAST_REQUEST_ID;
      ta.style.position="fixed";
      ta.style.opacity="0";
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
    }
    showToast("ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…");
  }catch(e){
    console.error(e);
    showToast("ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø® â€” Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§");
  }
}
function printRequestId(){
  if(!LAST_REQUEST_ID){ alert("Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©"); return; }
  const w = window.open("", "_blank", "width=520,height=420");
  if(!w){ alert("Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©"); return; }
  w.document.write(`
    <html lang="ar" dir="rtl">
    <head>
      <meta charset="utf-8" />
      <title>Ø·Ø¨Ø§Ø¹Ø© Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</title>
      <style>
        body{font-family:Tajawal,Arial;padding:24px; background:#fff; color:#111}
        .box{border:1px solid #ddd;border-radius:14px;padding:18px}
        h2{margin:0 0 10px}
        .id{direction:ltr;text-align:left;font-size:20px;font-weight:900;padding:12px;border-radius:12px;background:#f7f7fb;border:1px dashed #b88fcf}
        .muted{color:#555;font-size:13px;line-height:1.7;margin-top:10px}
        button{margin-top:14px;padding:10px 14px;border:0;border-radius:12px;background:#7a5ea8;color:#fff;font-weight:800;cursor:pointer}
      </style>
    </head>
    <body>
      <div class="box">
        <h2>Ø±Ù‚Ù… Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø±Ø¹</h2>
        <div class="id">${String(LAST_REQUEST_ID).replace(/</g,"&lt;")}</div>
        <div class="muted">Ø§Ø­ØªÙØ¸ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.</div>
        <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </body>
    </html>
  `);
  w.document.close();
}
function goToRafahSite(){
  window.open("https://rafah.org.sa", "_blank");
}
function tryClosePage(){
  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ø¯ Ù„Ø§ ÙŠØ³Ù…Ø­ Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø¥ØºÙ„Ø§Ù‚ ØªØ¨ÙˆÙŠØ¨ Ù„Ù… ÙŠÙØªØ­ Ø¹Ø¨Ø± window.open
  window.close();
  setTimeout(()=>{ showToast("Ø¥Ø°Ø§ Ù„Ù… ØªÙØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø©ØŒ Ø£ØºÙ„Ù‚Ù‡Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§"); }, 250);
}

function submitForm(){

  const inputs = document.querySelectorAll("#formModal input");

  const data = {
    name: inputs[0].value.trim(),
    phone: inputs[1].value.trim(),
    area: inputs[2].value.trim(),
    lat: lat,
    lng: lng,
    source: "Ø§Ù„Ù…ÙˆÙ‚Ø¹",
    notes: ""
  };

  // âœ… ØªØ£ÙƒÙŠØ¯ Ø£Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…ØªØµÙ„ Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª
  data.phone = data.phone.replace(/\D/g,'').slice(0,10);

  // ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ· (Ù†ÙØ³ Ù…Ù†Ø·Ù‚Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…ÙˆØ¬ÙˆØ¯ - Ù„Ù… ÙŠÙØ­Ø°Ù)
  if(!data.name || !data.phone || !data.area){
    // alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ø­ÙŠ");
    validateAll();
    return;
  }

  const phoneRegex = /^05\d{8}$/;
  if(!phoneRegex.test(data.phone)){
    // alert("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…");
    validateAll();
    showErr(phoneInput, errPhone, "Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…");
    return;
  }

  if(!data.lat || !data.lng){
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©");
    return;
  }

  // Ø±Ø§Ø¨Ø· Web App (Ù†ÙØ³ Ø§Ù„Ø°ÙŠ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡ ÙÙŠ Postman)
  const WEB_APP_URL = "/api/donate";

  // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
  const btns = document.querySelectorAll(".submit");
  btns.forEach(b => b.disabled = true);

  fetch(WEB_APP_URL, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    if(!res.success){
      throw new Error(res.error || "ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
    }

    // âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø±Ø¯ Ø§Ù„Ø³ÙŠØ±ÙØ±
    const requestId =
      res.requestId ||
      res.requestID ||
      res.id ||
      (res.data && (res.data.requestId || res.data.id)) ||
      "";

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­ÙØ¸ Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}

    // âœ… Ø¨Ø¯Ù„ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…ØŒ Ù†Ø¸Ù‡Ø± Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ Ø£Ø¬Ù…Ù„ (Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
    document.getElementById("formModal").style.display = "none";
    openSuccessModal(requestId);

    // ğŸ¯ ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ù…ØªØ­ÙƒÙ… ÙÙŠÙ‡)
    if(AUTO_REDIRECT_AFTER_SUCCESS){
      setTimeout(()=>{
        window.location.href = "https://rafah.org.sa";
      }, 2000);
    }
  })
  .catch(err => {
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
    console.error(err);
    btns.forEach(b => b.disabled = false);
    updateSubmitState();
  });
}

  /* ===== Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
function openConfirmModal(){
  // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ£ÙƒÙŠØ¯
  document.getElementById("cName").textContent  = nameInput.value;
  document.getElementById("cPhone").textContent = phoneInput.value;
  document.getElementById("cArea").textContent  = areaInput.value;

  document.getElementById("confirmModal").style.display = "flex";
}

function closeConfirm(){
  document.getElementById("confirmModal").style.display = "none";
}

/* Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯ */
function confirmSubmit(){
  closeConfirm();
  submitForm(); // Ù†ÙØ³ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
}
</script>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<div class="modal" id="confirmModal">
  <div class="modal-box">
    <h3 style="margin-top:0;text-align:center">ØªØ£ÙƒÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>

    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="cName"></span></p>
    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</strong> <span id="cPhone"></span></p>
    <p><strong>Ø§Ù„Ø­ÙŠ:</strong> <span id="cArea"></span></p>

    <button class="submit" onclick="closeConfirm()">âŒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button class="submit" onclick="confirmSubmit()">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<!-- âœ… Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ Ø¬Ø¯ÙŠØ¯Ø© (Ø¥Ø¶Ø§ÙØ© Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù Ø£ÙŠ Ø´ÙŠØ¡) -->
<div class="modal" id="successModal">
  <div class="success-box">
    <div class="success-head">
      <div class="success-icon">âœ…</div>
      <div>
        <h3 class="success-title">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­</h3>
        <div class="success-sub">Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ù‹Ø§ ğŸŒ· Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡.</div>
      </div>
    </div>

    <div class="req-card">
      <div class="req-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</div>
      <div class="req-id" id="sRequestId">...</div>

      <div class="req-actions">
        <button class="submit btn-ghost" onclick="copyRequestId()">ğŸ“‹ Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</button>
        <button class="submit btn-ghost" onclick="printRequestId()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</button>
        <button class="submit btn-site" onclick="goToRafahSite()">ğŸŒ Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©</button>
        <button class="submit btn-ok" onclick="closeSuccess()">âœ–ï¸ Ø¥ØºÙ„Ø§Ù‚</button>
      </div>

      <div class="req-actions" style="margin-top:10px">
        <button class="submit btn-ghost" onclick="tryClosePage()">ğŸšª Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©</button>
        <button class="submit btn-ghost" onclick="openForm()">â• Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¢Ø®Ø±</button>
      </div>

      <div class="small-note">
        â€¢ Ø§Ø­ØªÙØ¸ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.<br>
        â€¢ Ø²Ø± â€œØ¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©â€ Ù‚Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø£Ù…Ø§Ù†.
      </div>
    </div>
  </div>
</div>

</body>
</html>
